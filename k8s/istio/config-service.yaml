---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: config-service
spec:
  hosts:
  - config-service
  http:
  - route:
    - destination:
        host: config-service
        subset: "v1"
      weight: 100
    retries:
      attempts: 3
      perTryTimeout: 2s
    match:
    - sourceLabels:
        app: web-service
    - sourceLabels:
        app: accounts-service
    - sourceLabels:
        app: portfolio-service
    - sourceLabels:
        app: quotes-service
    - sourceLabels:
        app: user-service
---
apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: config-service
spec:
  host: config-service
  trafficPolicy:
    loadBalancer:
      simple: RANDOM
    connectionPool:
      tcp:
        maxConnections: 30
        connectTimeout: 100ms
      http:
        http1MaxPendingRequests: 10
        http2MaxRequests: 100
        maxRequestsPerConnection: 10
        maxRetries: 5
    outlierDetection:
      consecutiveErrors: 5
      interval: 30s
      baseEjectionTime: 60s
  subsets:
    - name: v1
      labels:
        version: "v1"

